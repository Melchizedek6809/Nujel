#!/usr/bin/env nujel

[def environment @[]]

[defun eval-in body
  [eval* [cons 'do [cons '[closure! [current-lambda] @[:data environment]] body]]]]

[pfmtln "Before: {environment}"]
[println [eval-in '[def c 1]]]
[println [eval-in '[def a 2]]]
[println [eval-in '[def d 3]]]
[println [eval-in '[def a 4]]]
[pfmtln "After: {environment}"]
