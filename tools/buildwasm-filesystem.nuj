#!/usr/bin/env nujel

[def directories '["binlib" "stdlib" "tests" "tools"]]
[def output-file "web/filesystem.json"]

[-> directories
    [map directory/read-recursive]
    [flatten]
    [filter [path/ext?! "nuj"]]
    [reduce [Î» [a b] [tree/set! a
                                [string->keyword b]
                                @[name: b content: [file/read b]]]]]
    [val->json]
    [file/write output-file]]
[println [cat [ref ansi-bg 2] "[JSON]" ansi-bg-reset " " output-file]]
